[gd_scene load_steps=34 format=3 uid="uid://blfbqbkkgmjan"]

[ext_resource type="PackedScene" uid="uid://d2m43c842xryf" path="res://2.Object/ConcreteObject/BaseEntity/base_entity_2d.tscn" id="1_jout7"]
[ext_resource type="Script" uid="uid://cqa8daniccovi" path="res://2.Object/ConcreteObject/Entity/Character/entity_character_rafiz.gd" id="2_jh22c"]
[ext_resource type="Script" uid="uid://cgi5wxrd3qs15" path="res://addons/godot_projectile_engine/core/projectile_wrapper/projectile_wrapper_2d.gd" id="3_4rd36"]
[ext_resource type="PackedScene" uid="uid://dpfhs6upk26ww" path="res://5.Resouces/VFX/Particle/vfx_blood_splatter_player.tscn" id="3_db6hw"]
[ext_resource type="Texture2D" uid="uid://q70c17vlloqu" path="res://8.Asset/2D/Character/teture_character.png" id="3_mfd41"]
[ext_resource type="Script" uid="uid://cnqgcej10tinn" path="res://addons/godot_projectile_engine/core/projectile_spawner/projectile_spawner.gd" id="4_rsovm"]
[ext_resource type="Script" uid="uid://bc73oiea731jc" path="res://addons/godot_projectile_engine/core/pattern_composer/pattern_composer.gd" id="5_e8h5j"]
[ext_resource type="Resource" uid="uid://cpjxk4s5a86kg" path="res://5.Resouces/GodotProjectile/charcter_projectile.tres" id="6_6mdho"]
[ext_resource type="Script" uid="uid://co24jiat0y46s" path="res://addons/godot_projectile_engine/core/pattern_composer/component/PCCSingle2D.gd" id="6_mfd41"]
[ext_resource type="Script" uid="uid://b8nclaklcf4uu" path="res://addons/godot_projectile_engine/core/timing_scheduler/timing_scheduler.gd" id="7_6mdho"]
[ext_resource type="Script" uid="uid://sjpvs4m6jk71" path="res://addons/godot_projectile_engine/core/timing_scheduler/repeater/tsc_repeater.gd" id="9_e8h5j"]
[ext_resource type="Script" uid="uid://cxd4b10ln1ddc" path="res://3.System/Component/Hitflash/hit_flash.gd" id="12_db6hw"]
[ext_resource type="AudioStream" uid="uid://c1t4ro0dij1o2" path="res://8.Asset/Audio/SFX/sfx_shoot_character.ogg" id="13_xdctc"]
[ext_resource type="AudioStream" uid="uid://dcwamx5oxperc" path="res://8.Asset/Audio/SFX/sfx_character_moving.ogg" id="14_ny46h"]
[ext_resource type="AudioStream" uid="uid://c74ftbm5susus" path="res://8.Asset/Audio/SFX/sfx_hurt_character.ogg" id="15_cpnbo"]

[sub_resource type="CircleShape2D" id="CircleShape2D_db6hw"]
radius = 2.0

[sub_resource type="CircleShape2D" id="CircleShape2D_xdctc"]
radius = 4.0

[sub_resource type="Shader" id="Shader_0q8vx"]
code = "shader_type canvas_item;

uniform vec4 color : source_color = vec4(1.0);
uniform float width : hint_range(0, 10) = 1.0;
uniform int pattern : hint_range(0, 2) = 0; // diamond, circle, square
uniform bool inside = false;
uniform bool add_margins = true; // only useful when inside is false

void vertex() {
	if (add_margins) {
		VERTEX += (UV * 2.0 - 1.0) * width;
	}
}

bool hasContraryNeighbour(vec2 uv, vec2 texture_pixel_size, sampler2D texture) {
	for (float i = -ceil(width); i <= ceil(width); i++) {
		float x = abs(i) > width ? width * sign(i) : i;
		float offset;
		
		if (pattern == 0) {
			offset = width - abs(x);
		} else if (pattern == 1) {
			offset = floor(sqrt(pow(width + 0.5, 2) - x * x));
		} else if (pattern == 2) {
			offset = width;
		}
		
		for (float j = -ceil(offset); j <= ceil(offset); j++) {
			float y = abs(j) > offset ? offset * sign(j) : j;
			vec2 xy = uv + texture_pixel_size * vec2(x, y);
			
			if ((xy != clamp(xy, vec2(0.0), vec2(1.0)) || texture(texture, xy).a <= 0.0) == inside) {
				return true;
			}
		}
	}
	
	return false;
}

void fragment() {
	vec2 uv = UV;
	
	if (add_margins) {
		vec2 texture_pixel_size = vec2(1.0) / (vec2(1.0) / TEXTURE_PIXEL_SIZE + vec2(width * 2.0));
		
		uv = (uv - texture_pixel_size * width) * TEXTURE_PIXEL_SIZE / texture_pixel_size;
		
		if (uv != clamp(uv, vec2(0.0), vec2(1.0))) {
			COLOR.a = 0.0;
		} else {
			COLOR = texture(TEXTURE, uv);
		}
	} else {
		COLOR = texture(TEXTURE, uv);
	}
	
	if ((COLOR.a > 0.0) == inside && hasContraryNeighbour(uv, TEXTURE_PIXEL_SIZE, TEXTURE)) {
		COLOR.rgb = inside ? mix(COLOR.rgb, color.rgb, color.a) : color.rgb;
		COLOR.a += (1.0 - COLOR.a) * color.a;
	}
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_db6hw"]
shader = SubResource("Shader_0q8vx")
shader_parameter/color = Color(0.23122677, 0.1044, 0.58, 0.9019608)
shader_parameter/width = 1.0
shader_parameter/pattern = 0
shader_parameter/inside = false
shader_parameter/add_margins = true

[sub_resource type="Gradient" id="Gradient_xdctc"]
offsets = PackedFloat32Array(0, 0.5, 0.8)
colors = PackedColorArray(0.74, 0.27873334, 0.11099999, 0.77254903, 0.87, 0.52548, 0.1044, 1, 0.86, 0.27305, 0.07739998, 1)
metadata/_snap_enabled = true

[sub_resource type="GradientTexture2D" id="GradientTexture2D_ny46h"]
gradient = SubResource("Gradient_xdctc")
width = 1
height = 10
fill_from = Vector2(0.6137446, 0)
fill_to = Vector2(0.6137446, 1)

[sub_resource type="Curve" id="Curve_xdctc"]
_data = [Vector2(0.7496564, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_ny46h"]
curve = SubResource("Curve_xdctc")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_db6hw"]
particle_flag_align_y = true
particle_flag_disable_z = true
spread = 40.0
initial_velocity_min = 60.0
initial_velocity_max = 120.0
gravity = Vector3(0, 0, 0)
damping_min = 32.278
damping_max = 50.843002
alpha_curve = SubResource("CurveTexture_ny46h")

[sub_resource type="Animation" id="Animation_xdctc"]
length = 0.001

[sub_resource type="Animation" id="Animation_db6hw"]
resource_name = "hurt_flash"
length = 0.16666834
step = 0.016666668
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.049999997, 0.08333333, 0.16666667),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 1), Color(0.19071998, 0.14080001, 0.64, 1), Color(0.19071998, 0.14080001, 0.64, 1), Color(1, 1, 1, 1)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_xdctc"]
_data = {
&"RESET": SubResource("Animation_xdctc"),
&"hurt_flash": SubResource("Animation_db6hw")
}

[sub_resource type="Gradient" id="Gradient_db6hw"]
interpolation_mode = 1
offsets = PackedFloat32Array(0, 0.60561675, 1)
colors = PackedColorArray(1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_5pvta"]
gradient = SubResource("Gradient_db6hw")
width = 7
height = 7
fill = 1
fill_from = Vector2(0.5, 0.5)
metadata/_snap_enabled = true

[sub_resource type="Curve" id="Curve_db6hw"]
_data = [Vector2(0.62820816, 1), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="CurveTexture" id="CurveTexture_xdctc"]
curve = SubResource("Curve_db6hw")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_ny46h"]
particle_flag_disable_z = true
gravity = Vector3(0, -20, 0)
scale_min = 0.79999995
scale_max = 1.1999999
color = Color(0.29602677, 0.15640001, 0.68, 0.7882353)
alpha_curve = SubResource("CurveTexture_xdctc")
hue_variation_min = -0.050000023
hue_variation_max = 0.049999975

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_cpnbo"]
random_pitch = 1.2
streams_count = 1
stream_0/stream = ExtResource("14_ny46h")

[node name="EntityCharacterRafiz" node_paths=PackedStringArray("asp_moving", "weapon") groups=["PlayerCharacter"] instance=ExtResource("1_jout7")]
z_index = 5
collision_layer = 2
collision_mask = 4384
motion_mode = 1
floor_stop_on_slope = false
platform_floor_layers = 4294962816
script = ExtResource("2_jh22c")
asp_moving = NodePath("AudioStreamPlayer2D2")
max_speed = 80.0
acceleration_ticks = 40.0
friction_ticks = 80.0
vfx_blood_splatter = ExtResource("3_db6hw")
weapon = NodePath("ProjectileWrapper2D2")
metadata/hitbox = Object(Area2D,"_import_path":NodePath(""),"unique_name_in_owner":false,"process_mode":0,"process_priority":0,"process_physics_priority":0,"process_thread_group":0,"physics_interpolation_mode":0,"auto_translate_mode":0,"editor_description":"","visible":true,"modulate":Color(1, 1, 1, 1),"self_modulate":Color(1, 1, 1, 1),"show_behind_parent":false,"top_level":false,"light_mask":1,"visibility_layer":1,"z_index":0,"z_as_relative":true,"y_sort_enabled":false,"texture_filter":0,"texture_repeat":0,"material":null,"use_parent_material":false,"position":Vector2(0, 0),"rotation":0.0,"scale":Vector2(1, 1),"skew":0.0,"disable_mode":0,"collision_layer":1,"collision_mask":1,"collision_priority":1.0,"input_pickable":true,"monitoring":true,"monitorable":true,"priority":0,"gravity_space_override":0,"gravity_point":false,"gravity_point_unit_distance":0.0,"gravity_point_center":Vector2(0, 1),"gravity_direction":Vector2(0, 1),"gravity":980.0,"linear_damp_space_override":0,"linear_damp":0.1,"angular_damp_space_override":0,"angular_damp":1.0,"audio_bus_override":false,"audio_bus_name":&"Master","script":Resource("res://3.System/Component/Hitbox/hitbox2d.gd"),"value":1.0,"collision_shape":null,"reset_after":-1.0,"active":true,"component":2,"allow_duplicates":false,"reset_timer":null,"metadata/_custom_type_script":"uid://co6iiaejrsqq3")


[node name="CollisionShape2D" type="CollisionShape2D" parent="." index="0"]
shape = SubResource("CircleShape2D_db6hw")

[node name="HurtBox2D" parent="." index="1" node_paths=PackedStringArray("health", "collision_shape")]
collision_layer = 20
collision_mask = 3072
health = NodePath("../Health")
collision_shape = NodePath("CollisionShape2D")

[node name="CollisionShape2D" type="CollisionShape2D" parent="HurtBox2D" index="0"]
shape = SubResource("CircleShape2D_xdctc")

[node name="Health" parent="." index="2"]
max_health = 99999
invincible_duration = 10

[node name="Sprite2D" type="Sprite2D" parent="." index="3"]
texture_filter = 1
material = SubResource("ShaderMaterial_db6hw")
texture = ExtResource("3_mfd41")

[node name="ProjectileWrapper2D2" type="Node2D" parent="." index="4" node_paths=PackedStringArray("projectile_spawner_2d", "projectile_spawners")]
position = Vector2(5, 0)
script = ExtResource("3_4rd36")
projectile_spawner_2d = NodePath("ProjectileSpawner2D")
projectile_spawners = [NodePath("ProjectileSpawner2D")]
metadata/_custom_type_script = "uid://cgi5wxrd3qs15"

[node name="ProjectileSpawner2D" type="Node2D" parent="ProjectileWrapper2D2" index="0" node_paths=PackedStringArray("timing_scheduler", "particle_2d", "audio_stream_2d")]
z_index = 4
script = ExtResource("4_rsovm")
active = false
projectile_composer_name = "pc_character"
projectile_template_2d = ExtResource("6_6mdho")
timing_scheduler = NodePath("../TimingScheduler")
particle_2d = NodePath("../GPUParticles2D")
audio_stream_2d = NodePath("../../AudioStreamPlayer2D")
metadata/_custom_type_script = "uid://cnqgcej10tinn"

[node name="PatternComposer2D" type="Node" parent="ProjectileWrapper2D2" index="1"]
script = ExtResource("5_e8h5j")
composer_name = "pc_character"
metadata/_custom_type_script = "uid://bc73oiea731jc"

[node name="PCCSingle2D" type="Node" parent="ProjectileWrapper2D2/PatternComposer2D" index="0"]
unique_name_in_owner = true
script = ExtResource("6_mfd41")
direction_type = 3
rotation_random = Vector3(0, 15, 1)
metadata/_custom_type_script = "uid://co24jiat0y46s"

[node name="TimingScheduler" type="Node" parent="ProjectileWrapper2D2" index="2"]
script = ExtResource("7_6mdho")
metadata/_custom_type_script = "uid://b8nclaklcf4uu"

[node name="TSCRepeater" type="Node" parent="ProjectileWrapper2D2/TimingScheduler" index="0"]
unique_name_in_owner = true
script = ExtResource("9_e8h5j")
duration = 0.4
metadata/_custom_type_script = "uid://sjpvs4m6jk71"

[node name="GPUParticles2D" type="GPUParticles2D" parent="ProjectileWrapper2D2" index="3"]
position = Vector2(-3, 0)
emitting = false
texture = SubResource("GradientTexture2D_ny46h")
lifetime = 0.08
one_shot = true
explosiveness = 0.98
process_material = SubResource("ParticleProcessMaterial_db6hw")

[node name="HurtFlash" type="Node2D" parent="." index="6" node_paths=PackedStringArray("animation_player", "health", "hurt_sound_2d")]
script = ExtResource("12_db6hw")
animation_player = NodePath("../AnimationPlayer")
health = NodePath("../Health")
hurt_sound_2d = NodePath("../AudioStreamPlayer2D3")
metadata/_custom_type_script = "uid://cxd4b10ln1ddc"

[node name="AnimationPlayer" type="AnimationPlayer" parent="." index="7"]
libraries = {
&"": SubResource("AnimationLibrary_xdctc")
}

[node name="GPUParticles2D" type="GPUParticles2D" parent="." index="8"]
z_index = -1
position = Vector2(-4, 0)
amount = 4
texture = SubResource("GradientTexture2D_5pvta")
lifetime = 0.63
explosiveness = 0.05
process_material = SubResource("ParticleProcessMaterial_ny46h")

[node name="AudioListener2D" type="AudioListener2D" parent="." index="9"]

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="." index="10"]
stream = ExtResource("13_xdctc")
bus = &"SFX"

[node name="AudioStreamPlayer2D2" type="AudioStreamPlayer2D" parent="." index="11"]
stream = SubResource("AudioStreamRandomizer_cpnbo")
bus = &"SFX"

[node name="AudioStreamPlayer2D3" type="AudioStreamPlayer2D" parent="." index="12"]
stream = ExtResource("15_cpnbo")
bus = &"SFX"
